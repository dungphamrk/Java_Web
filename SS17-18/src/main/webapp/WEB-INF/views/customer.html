<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <div th:fragment="body" class="container mx-auto p-4">
    <h2 class="text-2xl font-bold mb-4">Quản lý người dùng</h2>

    <!-- Form tìm kiếm -->
    <form th:action="@{/admin(section='customers')}" method="get" class="mb-4">
      <div class="flex gap-4">
        <input type="text" name="search" class="border rounded p-2 w-full" placeholder="Tìm kiếm theo tên hoặc email" th:value="${search}">
        <button type="submit" class="bg-blue-500 text-white rounded p-2 hover:bg-blue-600">Tìm kiếm</button>
      </div>
    </form>

    <!-- Thông báo -->
    <div th:if="${successMessage}" class="bg-green-100 text-green-700 p-3 rounded mb-4" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="bg-red-100 text-red-700 p-3 rounded mb-4" th:text="${errorMessage}"></div>

    <!-- Bảng người dùng -->
    <div class="overflow-x-auto">
      <table class="w-full border bg-white">
        <thead>
          <tr class="bg-gray-200">
            <th class="p-2 text-left">ID</th>
            <th class="p-2 text-left">Tên người dùng</th>
            <th class="p-2 text-left">Email</th>
            <th class="p-2 text-left">Vai trò</th>
            <th class="p-2 text-left">Trạng thái</th>
            <th class="p-2 text-left">Hành động</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="customer : ${customers}" class="border-t">
            <td class="p-2" th:text="${customer.id}"></td>
            <td class="p-2" th:text="${customer.username}"></td>
            <td class="p-2" th:text="${customer.email}"></td>
            <td class="p-2" th:text="${customer.role}"></td>
            <td class="p-2" th:text="${customer.status} ? 'Hoạt động' : 'Khóa'"></td>
            <td class="p-2">
              <a th:href="@{/customers/toggle/{id}(id=${customer.id})}"
                 th:text="${customer.status} ? 'Khóa' : 'Mở khóa'"
                 class="bg-yellow-500 text-white rounded p-1 hover:bg-yellow-600"></a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Phân trang -->
    <nav class="mt-4">
      <ul class="flex justify-center space-x-2">
        <li th:class="${currentPage == 0} ? 'opacity-50 cursor-not-allowed' : ''">
          <a class="bg-gray-300 rounded p-2" th:href="@{/admin(section='customers', page=${currentPage - 1}, pageSize=${pageSize}, search=${search})}">Trước</a>
        </li>
        <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}" th:class="${i == currentPage} ? 'bg-blue-500 text-white' : 'bg-gray-300'">
          <a class="rounded p-2" th:href="@{/admin(section='customers', page=${i}, pageSize=${pageSize}, search=${search})}" th:text="${i + 1}"></a>
        </li>
        <li th:class="${currentPage == totalPages - 1} ? 'opacity-50 cursor-not-allowed' : ''">
          <a class="bg-gray-300 rounded p-2" th:href="@{/admin(section='customers', page=${currentPage + 1}, pageSize=${pageSize}, search=${search})}">Tiếp</a>
        </li>
      </ul>
    </nav>
  </div>
</html>