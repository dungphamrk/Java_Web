<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <div th:fragment="body" class="container mx-auto p-4">
    <h2 class="text-2xl font-bold mb-4">Quản lý sản phẩm</h2>

    <!-- Form lọc sản phẩm -->
    <form th:action="@{/admin(section='products')}" method="get" class="mb-4">
      <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
        <input type="text" name="name" class="border rounded p-2" placeholder="Tên sản phẩm" th:value="${name}">
        <input type="number" name="minPrice" class="border rounded p-2" placeholder="Giá tối thiểu" step="0.01" th:value="${minPrice}">
        <input type="number" name="maxPrice" class="border rounded p-2" placeholder="Giá tối đa" step="0.01" th:value="${maxPrice}">
        <input type="number" name="minStock" class="border rounded p-2" placeholder="Tồn kho tối thiểu" th:value="${minStock}">
        <button type="submit" class="bg-blue-500 text-white rounded p-2 hover:bg-blue-600">Lọc</button>
      </div>
    </form>

    <!-- Nút thêm sản phẩm -->
    <a th:href="@{/products/new}" class="inline-block bg-green-500 text-white rounded p-2 mb-4 hover:bg-green-600">Thêm sản phẩm</a>

    <!-- Thông báo -->
    <div th:if="${successMessage}" class="bg-green-100 text-green-700 p-3 rounded mb-4" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="bg-red-100 text-red-700 p-3 rounded mb-4" th:text="${errorMessage}"></div>

    <!-- Bảng sản phẩm -->
    <div class="overflow-x-auto">
      <table class="w-full border bg-white">
        <thead>
          <tr class="bg-gray-200">
            <th class="p-2 text-left">ID</th>
            <th class="p-2 text-left">Tên</th>
            <th class="p-2 text-left">Mô tả</th>
            <th class="p-2 text-left">Giá</th>
            <th class="p-2 text-left">Tồn kho</th>
            <th class="p-2 text-left">Hình ảnh</th>
            <th class="p-2 text-left">Hành động</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="product : ${products}" class="border-t">
            <td class="p-2" th:text="${product.id}"></td>
            <td class="p-2" th:text="${product.productName}"></td>
            <td class="p-2" th:text="${product.description}"></td>
            <td class="p-2" th:text="${product.price}"></td>
            <td class="p-2" th:text="${product.stock}"></td>
            <td class="p-2">
              <img th:if="${product.image}" th:src="${product.image}" alt="Hình ảnh sản phẩm" class="w-12 h-12 object-cover"/>
              <span th:unless="${product.image}">Không có ảnh</span>
            </td>
            <td class="p-2">
              <a th:href="@{/products/edit/{id}(id=${product.id})}" class="bg-yellow-500 text-white rounded p-1 hover:bg-yellow-600">Sửa</a>
              <a th:href="@{/products/delete/{id}(id=${product.id})}" class="bg-red-500 text-white rounded p-1 hover:bg-red-600" onclick="return confirm('Bạn có chắc muốn xóa?')">Xóa</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Phân trang -->
    <nav class="mt-4">
      <ul class="flex justify-center space-x-2">
        <li th:class="${currentPage == 0} ? 'opacity-50 cursor-not-allowed' : ''">
          <a class="bg-gray-300 rounded p-2" th:href="@{/admin(section='products', page=${currentPage - 1}, pageSize=${pageSize}, name=${name}, minPrice=${minPrice}, maxPrice=${maxPrice}, minStock=${minStock})}">Trước</a>
        </li>
        <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}" th:class="${i == currentPage} ? 'bg-blue-500 text-white' : 'bg-gray-300'">
          <a class="rounded p-2" th:href="@{/admin(section='products', page=${i}, pageSize=${pageSize}, name=${name}, minPrice=${minPrice}, maxPrice=${maxPrice}, minStock=${minStock})}" th:text="${i + 1}"></a>
        </li>
        <li th:class="${currentPage == totalPages - 1} ? 'opacity-50 cursor-not-allowed' : ''">
          <a class="bg-gray-300 rounded p-2" th:href="@{/admin(section='products', page=${currentPage + 1}, pageSize=${pageSize}, name=${name}, minPrice=${minPrice}, maxPrice=${maxPrice}, minStock=${minStock})}">Tiếp</a>
        </li>
      </ul>
    </nav>
  </div>
</html>